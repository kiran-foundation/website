---
import { getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";

const info = (await getEntry("support-form", "unsuccessful")).data;
---

<Layout>
  <div class="max-w-full mx-auto pt-[8rem] overflow-hidden pb-[500px]">
    <h1
      class="tracking-normal text-center heading-1 font-[600] text-[1.5rem] md:text-[2rem] leading-[140%]"
    >
      {info.title}
    </h1>
    <h3 id="error-message" class="body-text-1 text-center pt-5">
      {info.errorMessage}
    </h3>
    <h3 id="transaction-id" class="body-text-1 text-center pt-2">
      {info.transactionId}
    </h3>

    <script is:inline
      src="https://unpkg.com/@lottiefiles/lottie-player@2.0.12/dist/lottie-player.js"
      type="module">
    </script>

    <lottie-player
      src={info.animation || "/assets/animations/error-fallback.json"}
      background="transparent"
      speed="1"
      style="width: 25rem; height: 25rem; overflow: hidden; margin: auto;"
      direction="1"
      playMode="normal"
      loop
      autoplay
      id="lottie-player"
    >
    </lottie-player>

    <script is:inline>
      // Get URL parameters from client-side
      const urlParams = new URLSearchParams(window.location.search);
      const errorMessage = urlParams.get('message') || 'Payment could not be processed';
      const transactionId = urlParams.get('txnId') || 'N/A';

      // Replace placeholders with actual values
      const errorText = `Error: ${errorMessage}`;
      const idText = `Reference ID: ${transactionId}`;

      // Update the DOM elements
      document.getElementById('error-message').innerHTML = errorText;
      document.getElementById('transaction-id').innerHTML = idText;
    </script>
  </div>
</Layout>