---
import UpdateCard from "./UpdateCard.astro";
import Button from "./button.astro";
import { getCollection } from "astro:content";

export async function getAllUpdates() {
  return await getCollection("updates");
}

const allUpdates = await getAllUpdates();
const updates = allUpdates.map((update) => ({
  ...update.data,
}));

const { showHighPriorityOnly = false, isMainPage = false } = Astro.props;

const filteredUpdates = updates
  .filter((update) => !showHighPriorityOnly || update.priority === "high")
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

const updatesToDisplay = showHighPriorityOnly
  ? filteredUpdates.slice(0, 3)
  : filteredUpdates;
---

<!-- Main Container -->
<div
  class="max-w-[1296px] mx-auto border-2 border-red-500 mt-8 md:mt-[11.5rem]  mb-[7.5rem]  flex items-center justify-center flex-col p-1"
>
  <!-- News & Updates Section -->
  <section
    class="w-full bg-white border-2 border-blue-500"
  >
    <div class="w-full">
      <h2
        class="text-3xl md:text-4xl xl:text-[2.6rem]  font-merriweather text-center py-3 mb-[11.5rem] border-2 border-black"
      >
        News and Updates
      </h2>

      <!-- Updates Grid -->
      <div
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-12  max-w-7xl mx-auto border-2 border-green-500"
      >
        {
          updatesToDisplay.map((update) => (
            <UpdateCard update={update} class="border-2 border-purple-400" />
          ))
        }
      </div>

      <!-- See More Button -->
      {
        isMainPage && (
          <div class="text-center mb-1 mt-16 border-2 border-yellow-500">
            <Button link="updates" title="See More" btn="btn3" />
          </div>
        )
      }
    </div>
  </section>
</div>
