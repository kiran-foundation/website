---
import { getEntry } from "astro:content";
const heroData = (await getEntry("donation", "hero")).data;
---

<section
    class="position-relative"
    style="margin-top: 4rem; margin-bottom: 5rem;"
>
    <div
        class="position-absolute object-fit-cover w-100 h-100 top-0 start-0 bg-size-cover bg-position-center mt-4"
        style="background-image: url(/assets/images/programs/donationhero1.png);"
    >
    </div>

    <div class="hero-container">
        <h1 class="hero-title display-0 text-white pt-5 z-2">
            {
                heroData.heading ||
                    "Make a Lasting Impact: Support the Future with Your Donation"
            }
        </h1>

        <div
            class="container position-relative z-2 text-center pt-5 donation-form-container"
        >
            <div
                class="donation-form-wrapper p-4 bg-white shadow rounded form-container"
            >
                <div class="form-img">
                    <img
                        src="/assets/images/programs/formimage.png"
                        alt=""
                        class="formm-imgg"
                    />
                </div>
                <div class="formm">
                    <h3 class="form-title mb-4">Make a Donation</h3>
                    <form action="/donationform" method="get" id="donationForm">

                        <!-- Donation Amount -->

                        <div class="mb-4">
                            <label class="form-label"
                                >Choose a donation amount</label
                            >
                            <div id="donationAmountOptions">
                                <!-- Dynamic donation amounts will appear here -->
                            </div>
                            <div
                                id="customAmountInput"
                                class="mt-3"
                                style="display: none;"
                            >
                                <input
                                    type="number"
                                    class="form-control"
                                    name="customAmount"
                                    placeholder="Enter your custom donation amount"
                                    min="1"
                                />
                            </div>
                        </div>
                        <!-- Donation Frequency -->
                        <div class="mb-4">
                            <label class="form-label"
                                >Choose a donation frequency</label
                            >
                            <div class="form-check">
                                <input
                                    class="form-check-input"
                                    type="radio"
                                    name="donationFrequency"
                                    id="monthly"
                                    value="monthly"
                                    checked
                                />
                                <label class="form-check-label" for="monthly"
                                    >Monthly</label
                                >
                            </div>
                            <div class="form-check">
                                <input
                                    class="form-check-input"
                                    type="radio"
                                    name="donationFrequency"
                                    id="onetime"
                                    value="onetime"
                                />
                                <label class="form-check-label" for="onetime"
                                    >One time</label
                                >
                            </div>
                        </div>


                        <p class="form-text mt-3">
                            Every gift, whether monthly or one-time, makes a
                            profound impact. We appreciate your commitment to
                            fostering hope and resilience within our community.
                            Thank you for being part of this transformative
                            journey.
                        </p>
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-secondary"
                                >Cancel</button
                            >
                            <button type="submit" class="btn btn-primary"
                                >Donate Now</button
                            >
                        </div>

                        <!-- Hidden inputs for dynamic values -->
                        <input type="hidden" name="plan_id" id="planIdInput" />
                        <input type="hidden" name="amount" id="amountInput" />
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const onetimeAmounts = [
            { value: "500", label: "₹500" },
            { value: "1000", label: "₹1000" },
            { value: "5000", label: "₹5000" },
            { value: "custom", label: "Custom donation" },
        ];
        const monthlyAmounts = [
            { value: "plan_PFJfnMnXPs6TMS", label: "₹5000 per month" },
            { value: "plan_PFJfPtteneZ7Tn", label: "₹1001 per month" },
            { value: "plan_PFJa00kkaP1Tdb", label: "₹500 per month" },
        ];

        const donationFrequencyInputs =
            document.querySelectorAll<HTMLInputElement>(
                'input[name="donationFrequency"]',
            );
        const donationAmountOptions = document.getElementById(
            "donationAmountOptions",
        )!;
        const customAmountInput = document.getElementById("customAmountInput")!;

        function updateDonationAmounts(frequency: string) {
            const amounts =
                frequency === "monthly" ? monthlyAmounts : onetimeAmounts;
            donationAmountOptions.innerHTML = amounts
                .map(
                    ({ value, label }) => `
                    <div class="form-check">
                        <input
                            class="form-check-input"
                            type="radio"
                            name="donationAmount"
                            id="amount-${value}"
                            value="${value}"
                            ${
                                value === "500" || value === "plan_nMn"
                                    ? "checked"
                                    : ""
                            }
                        />
                        <label class="form-check-label" for="amount-${value}">${label}</label>
                    </div>
                `,
                )
                .join("");

            const customInput = document.querySelector<HTMLInputElement>(
                'input[value="custom"]',
            );
            if (customInput) {
                customInput.addEventListener("change", () => {
                    customAmountInput.style.display = customInput.checked
                        ? "block"
                        : "none";
                });
            }
            customAmountInput.style.display = "none"; // Hide custom input by default
        }

        donationFrequencyInputs.forEach((input) => {
            input.addEventListener("change", (event) => {
                updateDonationAmounts((event.target as HTMLInputElement).value);
            });
        });

        // Initialize form with monthly amounts by default
        updateDonationAmounts("monthly");

        const form = document.getElementById("donationForm")!;
        form.addEventListener("submit", (event) => {
            const selectedFrequency = document.querySelector<HTMLInputElement>(
                'input[name="donationFrequency"]:checked',
            )!.value;
            const selectedAmount = document.querySelector<HTMLInputElement>(
                'input[name="donationAmount"]:checked',
            )!.value;

            const planIdInput = document.getElementById(
                "planIdInput",
            ) as HTMLInputElement;
            const amountInput = document.getElementById(
                "amountInput",
            ) as HTMLInputElement;

            if (selectedFrequency === "monthly") {
                // Set plan_id for monthly
                planIdInput.value = selectedAmount;

                // Extract numeric amount from monthly label or set default
                const selectedLabel = monthlyAmounts.find(
                    (item) => item.value === selectedAmount,
                )?.label;
                const numericAmount = selectedLabel
                    ? selectedLabel.match(/\d+/)?.[0]
                    : "0";
                amountInput.value = numericAmount || "0";
            } else {
                // Handle one-time amounts
                amountInput.value =
                    selectedAmount === "custom"
                        ? (document.querySelector<HTMLInputElement>(
                              'input[name="customAmount"]',
                          )!.value as string)
                        : selectedAmount;
                planIdInput.value = "";
            }
        });
    });
</script>
